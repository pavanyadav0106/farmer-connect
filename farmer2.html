<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Farmer Connect</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: Arial, sans-serif;
    }
    body {
      background-color: #f0f2f5;
    }

    .top-nav {
  display: flex;
  align-items: center;
  justify-content: center; /* Center the title */
  padding: 15px 20px;
  position: fixed;
  width: 100%;
  top: 0;
  left: 0;
  background: #28a745;
  color: white;
  z-index: 1000;
  box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.2);
}
.dashboard-title {
  font-size: 22px;
  font-weight: bold;
  margin-left: 50px; /* Push the title right */
}
.overlay {
  display: none;
  position: fixed;
  inset: 0;  /* shorthand for top:0; right:0; bottom:0; left:0; */
  background: rgba(0, 0, 0, 0.5);
  z-index: 1999;  /* Lower than popup's 1000 */
}
.overlay.active {
  display: block;
}
@media (max-width: 600px) {
  .sidebar.active {
    display: none; /* Hide sidebar when popup is active on small screens */
  }
}


    /* Hero Section */
/* General Hero Section Styles */
.hero {
  background: url('https://i.ibb.co/fdw6Y2Xr/IMG-farmermobileinhand-HERO-L2-HRO-02-1440x400px-3.jpg') no-repeat center center/cover;
  height: 80vh;
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  color: white;
  padding: 20px;
  position: relative;
  margin-top: 80px;
}

/* Hero section overlay */
.hero::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.5);
}
.hero-content {
  max-width: 80%;
  font-size: 1.2rem;
  padding: 20px;
  border-radius: 10px;
}

/* Media query adjustments */
@media (max-width: 600px) {
  .hero {
    height: 60vh; /* Adjust height for mobile */
    padding: 14px;
  }

  .dashboard-title {
    font-size: 16px;
  }
  .feature i {
    font-size: 30px; /* Adjust icon size */
  }
  .ticker-container {
    top: 60px; /* Adjusted for mobile */
  }
  .hero-content {
    background: rgba(0, 0, 0, 0.7);
    padding: 10px;
    border-radius: 10px;
  }

  .sidebar {
    z-index: 999;
    width: 80%;
  }
}

  .hero-content h1 {
    font-size: clamp(1.2rem,5vw,2rem);
  }


.feature {
  transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
  cursor: pointer;
}

.feature:hover {
  transform: translateY(-5px);
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
}
.cta-button {
  position: relative;
  overflow: hidden;
}

.cta-button:hover {
  box-shadow: 0 0 10px #28a745, 0 0 40px #28a745;
}

/* Consolidate all sidebar styles */
.sidebar {
  position: fixed;
  top: 0;
  left: -250px; /* Hidden initially */
  width: 250px;
  height: 100%;
  background: #28a745;
  transition: left 0.3s ease-in-out;
  padding: 20px;
  color: white;
  z-index: 1500;
}

.sidebar.active {
  left: 0; /* Slide in */
}
/* Sidebar list and items */
.sidebar ul {
  list-style: none;
  padding: 0;
}

.sidebar ul li {
  padding: 15px 10px;
  border-bottom: 1px solid rgba(255, 255, 255, 0.2);
}

.sidebar ul li a {
  color: white;
  text-decoration: none;
  font-size: 18px;
  display: block;
}

.sidebar ul li a:hover {
  background: rgba(255, 255, 255, 0.2);
}

.logo-text {
  font-size: 24px;
  font-weight: bold;
  font-family: 'Poppins', sans-serif;
  letter-spacing: 1px;
  text-transform: uppercase;
  cursor: pointer;
}

    /* Sidebar Toggle Button */
    .menu-toggle {
  font-size: 24px;
  cursor: pointer;
  background: none;
  border: none;
  color: white;
  position: fixed;
  top: 15px;
  left: 20px; /* Shifted slightly right */
  z-index: 2001;
}
   /* Adjust Content */
   .main-content {
      transition: margin-left 0.3s ease;
      margin-left: 0;
      padding: 20px;
    }
    .main-content.shift {
      margin-left: 250px;
    }
    /* Key Features Section */
    .features {
      display: flex;
      justify-content: center;
      text-align: center;
      padding: 50px 20px;
      background: white;
      cursor: pointer;
      flex-wrap: wrap;
      gap:20px;
    }
    .feature {
      flex:1;
      min-width:250px;
      max-width: 300px;
    }
    .feature i {
      font-size: 40px;
      color: #28a745;
    }

    /* Testimonials Section */
    .testimonials {
      text-align: center;
      background: #fff;
      padding: 40px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }
    .testimonial {
      display: none;
      font-size: 18px;
      color: #333;
      opacity: 0;
      transition: opacity 1s ease-in-out; 
    }
    .testimonial.active {
      display: block;
      opacity: 1;
    }
    /* Footer */
    .footer {
      background: #28a745;
      color: white;
      text-align: center;
      padding: 20px;
    }
    
    /* Market Prices Ticker */
    .ticker-container {
  background: #d4edda;
  color: #155724;
  padding: 10px 0;
  overflow: hidden;
  white-space: nowrap;
  position: fixed;
  width: 100%;
  top: 60px; /* Adjust to avoid overlap */
  left: 0;
  z-index: 1000;
  font-weight: bold;
  border-bottom: 3px solid #28a745;
}


.ticker {
  display: inline-block;
  white-space: nowrap;
  font-size: 16px;
  animation: tickerScroll 35s linear infinite;
  overflow: hidden;
}
@keyframes tickerScroll {
  from { transform: translateX(100%); opacity: 1; }
  to { transform: translateX(-100%); opacity: 1; }
}
.popup {
  display: none;
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: white;
  padding: 20px;
  box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
  border-radius: 10px;
  width: 80%;
  max-width: 800px;
  z-index: 2000; /* Increase popup's z-index */
}

.popup.active {
    display: block; /* Ensure it‚Äôs visible when active */
}

.popup-content {
    text-align: center;
}

.close-btn {
    position: absolute;
    top: 10px;
    right: 15px;
    font-size: 20px;
    cursor: pointer;
}
 /* Weather Suggestions */
 .suggestion-box {
      border: 1px solid #ccc;
      background: #fff;
      max-height: 150px;
      overflow-y: auto;
      position: absolute;
      width: 80%;
      margin-top: 4px;
      z-index: 1002;
      display: none;
    }
    .suggestion {
      padding: 8px;
      cursor: pointer;
    }
    .suggestion:hover {
      background: #f0f0f0;
    }
    /* Weather Cards */
    .weather-cards {
  display: flex;
  flex-wrap: wrap;
  gap: 15px;
  justify-content: center;
}

    .weather-card {
      background: #f0f8ff;
      padding: 15px;
      border-radius: 20px;
      box-shadow: 0 8px 16px rgba(0,0,0,0.1);
      min-width: 150px;
      text-align: center;
      transition: transform 0.3s ease, opacity 0.3s ease;
      opacity: 0;
      transform: translateY(20px);
      animation: fadeInUp 0.6s ease forwards;
      cursor: pointer;
    }
    .weather-card h3 {
      margin: 10px 0;
      font-size: 18px;
    }
    .weather-card p {
      margin: 5px 0;
      font-size: 14px;
      color: #333;
    }
    @keyframes fadeInUp {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    @media (max-width: 600px) {
  .weather-card {
    width: 100%;
  }
}
#loading {
    opacity: 0;
    transition: opacity 0.3s ease-in-out;
}

#loading.show {
    opacity: 1;
}



  </style>
   <style>
    /* Style the modal (background) */
    .logout-modal {
        display: none; /* Hidden by default */
        position: fixed;
        z-index: 1;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0, 0, 0, 0.4);
    }
    
    .logout-modal-content {
        background-color: #fefefe;
        margin: 15% auto;
        padding: 20px;
        border: 1px solid #888;
        width: 300px;
        text-align: center;
        border-radius: 5px;
    }

    .close {
        color: #aaa;
        font-size: 28px;
        font-weight: bold;
        position: absolute;
        top: 5px;
        right: 10px;
    }

    .close:hover,
    .close:focus {
        color: black;
        text-decoration: none;
        cursor: pointer;
    }

    #confirmLogout, #cancelLogout {
        padding: 10px 20px;
        background-color: #ff4d4d;
        color: white;
        font-size: 16px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        margin: 10px;
    }

    #confirmLogout:hover, #cancelLogout:hover {
        background-color: #e60000;
    }

    #cancelLogout {
        background-color: #4caf50;
    }

    #cancelLogout:hover {
        background-color: #45a049;
    }
</style>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script>
    var firebaseConfig = {
      apiKey: "AIzaSyDPrPDAj7o58AijhzBpytGKcsuxHYCGhaY",
      authDomain: "farmer-connect-8d0ea.firebaseapp.com",
      projectId: "farmer-connect-8d0ea",
      storageBucket: "farmer-connect-8d0ea.appspot.com",
      messagingSenderId: "164327825853",
      appId: "1:164327825853:web:00c05f326aab3c4683b2d4"
    };
  firebase.initializeApp(firebaseConfig);

  var auth = firebase.auth();
</script>

</head>
<body>
  <div id="loading" style="display: none; text-align: center;">Loading...</div>

  <div class="top-nav">
  <span class="logo-text">üåæ Farmer Connect</span>
</div>
<div id="logoutModal" class="logout-modal">
  <div class="logout-modal-content">
      <span class="close">&times;</span>
      <p>Are you sure you want to log out?</p>
      <button id="confirmLogout">Yes</button>
      <button id="cancelLogout">No</button>
  </div>
</div>
  <!-- Hero Section -->
  <div class="hero">
    <div class="hero-content">
      <h1>Empowering Farmers with Real-Time Market Insights</h1>
      <p>Connecting farmers directly with markets, real-time updates, and expert insights.</p>
    </div>
  </div>
   <!-- Market Prices Ticker -->
   <div class="ticker-container">
    <div class="ticker" id="market-ticker">Loading market prices...</div>
  </div>

  <!-- Key Features Section -->
  <div class="features">
    <div class="feature">
      <i class="fas fa-chart-line"></i>
      <h3>Live Market Prices</h3>
      <p>Stay updated with real-time crop rates.</p>
    </div>
    <div class="feature">
      <i class="fas fa-cloud-sun"></i>
      <h3>Weather Forecast</h3>
      <p>Plan your farming with accurate weather data.</p>
    </div>
    <div class="feature">
      <i class="fas fa-newspaper"></i>
      <h3>Latest News</h3>
      <p>Get farming tips & industry updates.</p>
    </div>
    <div class="feature">
      <i class="fas fa-handshake"></i>
      <h3>Seamless Transactions</h3>
      <p>Sell crops easily with secure payments.</p>
    </div>
  </div>
  
  <!-- Testimonials Section -->
  <div class="testimonials">
    <h2>Farmers' Success Stories</h2>
    <div class="testimonial active">
      <p>"Farmer Connect helped me get better prices for my crops. Highly recommend!"</p>
      <h4>- Ramesh Patel, Gujarat</h4>
    </div>
    <div class="testimonial">
      <p>"With real-time weather updates, I planned my farming better and avoided losses."</p>
      <h4>- Sita Devi, Maharashtra</h4>
    </div>
    <div class="testimonial">
      <p>"Selling crops online has never been easier. The best platform for farmers!"</p>
      <h4>- Arjun Kumar, Punjab</h4>
    </div>
  </div>
  <div class="footer">
    <p>
      <a href="contact.html">Contact us</a> | 
      <a href="faq.html">FAQs</a> | 
      <a href="https://facebook.com" target="_blank">Social Media</a>
    </p>
  </div>
  <div class="sidebar" id="sidebar">
    <ul>
      <li><a href="#">Profile</a></li>
      <li><a href="#">My Crops</a></li>
      <li><a href="#">My Orders</a></li>
      <li><a href="#" id="weatherButton">Weather</a></li>
      <li><a href="#" id="logoutBtn">Log out</a></li>
    </ul>
  </div>
 <!-- Weather Popup -->
 <div id="weatherPopup" class="popup">
  <div class="popup-content">
    <span class="close-btn" onclick="closePopup()">&times;</span>
    <h2>Weather Forecast</h2>
    <!-- Input with suggestion box inside popup -->
    <div style="position: relative;">
      <input type="text" id="locationInput" placeholder="Enter city name" autocomplete="off" style="width:80%; padding:8px; margin-top:10px;">
      <div id="suggestionBox" class="suggestion-box"></div>
    </div>
    <button onclick="setLocation()" style="margin-top:10px; padding:8px 16px;">Get Weather</button>
    <div id="weatherData" style="margin-top:20px;"></div>
  </div>
</div>
 
  <!-- Overlay for Popup -->
  <div class="overlay"></div>

   <!-- Sidebar Toggle Button -->
   <button class="menu-toggle" id="menu-toggle"><i class="fas fa-bars"></i></button>
  
   <!-- Main Content -->
   <div class="main-content" id="main-content">
     <h1>Welcome to Farmer Connect</h1>
     <p>Empowering Farmers with Real-Time Market Insights</p>
   </div>
  
  <script>
    let index = 0;
    function showTestimonial() {
    const testimonials = document.querySelectorAll('.testimonial');
    testimonials.forEach(t => t.classList.remove('active'));
    testimonials[index].classList.add('active');
    index = (index + 1) % testimonials.length;
}
    setInterval(showTestimonial, 4000);
    showTestimonial();

let retryInterval = 30000;  // Start with 30 seconds
async function fetchMarketPrices(page = 1) {
  try {
    const response = await fetch(`https://api.data.gov.in/resource/9ef84268-d588-465a-a308-a864a43d0070?api-key=579b464db66ec23bdd0000011d1a465aad6d431b755d0dbc757078c7&format=json&page=${page}`);

    if (!response.ok) throw new Error("API response not OK");

    const data = await response.json();

    if (data.records) {
      const uniquePrices = {};
      data.records.forEach(record => {
        if (!uniquePrices[record.commodity]) {
          uniquePrices[record.commodity] = `${record.commodity}: ‚Çπ${record.modal_price}/quintal`;
        }
      });

      document.getElementById("market-ticker").textContent = Object.values(uniquePrices).join(" | ") || "Market data unavailable. Stay tuned!";
      
      // Reset retry interval if successful
      retryInterval = 30000;
    } else {
      throw new Error("No market data available");
    }
  } catch (error) {
    console.error("Error fetching prices:", error);
    document.getElementById("market-ticker").textContent = "Waiting for market data...";

    // Increase retry interval (Exponential backoff)
    retryInterval = Math.min(retryInterval * 2, 300000); // Max 5 minutes
  }

  setTimeout(() => fetchMarketPrices(), retryInterval);
}
fetchMarketPrices();  // Initial load
setInterval(fetchMarketPrices, 60000);  // Refresh prices every minute
document.getElementById("menu-toggle").addEventListener("click", function () {
  const sidebar = document.getElementById("sidebar");
  const mainContent = document.getElementById("main-content");

  // Toggle sidebar and shift content
  sidebar.classList.toggle("active");
  mainContent.classList.toggle("shift");

  // Save state
  localStorage.setItem("sidebarActive", sidebar.classList.contains("active"));
});

// Preserve sidebar state on reload
window.addEventListener("load", function () {
  let sidebar = document.getElementById("sidebar");
  let mainContent = document.getElementById("main-content");
  if (localStorage.getItem("sidebarActive") === "true") {
    sidebar.classList.add("active");
    mainContent.classList.add("shift");
  }
});
       // --- Weather & Autocomplete Logic ---
    // Use the same API key for both geocoding and weather
    const apiKey = "c3ccd39af45cee6cf2c3536080789469";
    const locationInput = document.getElementById("locationInput");
    const suggestionBox = document.getElementById("suggestionBox");
    
// Autocomplete for city names
locationInput.addEventListener("input", async function () {
  const query = locationInput.value;
  if (query.length < 2) {
    suggestionBox.style.display = "none";
    return;
  }

  const res = await fetch(`https://api.openweathermap.org/geo/1.0/direct?q=${query}&limit=5&appid=${apiKey}`);
  const data = await res.json();

  suggestionBox.innerHTML = "";
  data.forEach(city => {
    const suggestion = document.createElement("div");
    suggestion.className = "suggestion";
    suggestion.textContent = `${city.name}, ${city.country}`;
    suggestion.onclick = () => {
      locationInput.value = `${city.name}, ${city.country}`;
      locationInput.setAttribute("data-lat", city.lat);
      locationInput.setAttribute("data-lon", city.lon);
      suggestionBox.style.display = "none";
    };
    suggestionBox.appendChild(suggestion);
  });

  suggestionBox.style.display = data.length ? "block" : "none";
});

// Fetch and display 7-day forecast
async function setLocation() {
  const lat = locationInput.getAttribute("data-lat");
  const lon = locationInput.getAttribute("data-lon");

  if (!lat || !lon) {
    alert("Please select a valid location from suggestions.");
    return;
  }

  const res = await fetch(`https://api.openweathermap.org/data/2.5/onecall?lat=${lat}&lon=${lon}&exclude=minutely,hourly,alerts&units=metric&appid=${apiKey}`);
  const data = await res.json();

  const weatherData = document.getElementById("weatherData");
  weatherData.innerHTML = `<div class="weather-cards">${data.daily.slice(0, 7).map(day => {
  const date = new Date(day.dt * 1000).toDateString().slice(0, 10);
  const icon = day.weather[0].icon;
  return `
    <div class="weather-card fade-slide">
      <h3>${date}</h3>
      <img src="https://openweathermap.org/img/wn/${icon}@2x.png" alt="Weather Icon" class="weather-icon" />
      <p><strong>Day:</strong> ${day.temp.day}¬∞C</p>
      <p><strong>Night:</strong> ${day.temp.night}¬∞C</p>
      <p><strong>${day.weather[0].main}</strong> - ${day.weather[0].description}</p>
    </div>
  `;
}).join('')}</div>`;
}

// Open weather popup
document.getElementById("weatherButton").addEventListener("click", () => {
  document.getElementById("weatherPopup").classList.add("active");
  document.querySelector(".overlay").classList.add("active");
});

// Close popup
function closePopup() {
  document.getElementById("weatherPopup").classList.remove("active");
  document.querySelector(".overlay").classList.remove("active");
}


// Show popup
document.getElementById("weatherButton").addEventListener("click", () => {
  document.getElementById("weatherPopup").classList.add("active");
  document.querySelector(".overlay").classList.add("active");
});

// Close popup
function closePopup() {
  document.getElementById("weatherPopup").classList.remove("active");
  document.querySelector(".overlay").classList.remove("active");
}

// Fetch 7-day weather forecast
async function setLocation() {
  const query = locationInput.value.trim();
  if (!query) return;

  try {
    const geoRes = await fetch(`https://api.openweathermap.org/geo/1.0/direct?q=${query}&limit=1&appid=${apiKey}`);
    const geoData = await geoRes.json();
    if (!geoData.length) throw new Error("Location not found.");

    const { lat, lon } = geoData[0];
    const weatherRes = await fetch(`https://api.openweathermap.org/data/2.5/onecall?lat=${lat}&lon=${lon}&exclude=minutely,hourly,alerts&units=metric&appid=${apiKey}`);
    const weatherData = await weatherRes.json();

    const dailyData = weatherData.daily.slice(0, 7);
    const weatherHTML = dailyData.map(day => {
      const date = new Date(day.dt * 1000).toLocaleDateString();
      return `
        <div class="weather-card">
          <h3>${date}</h3>
          <p><strong>${day.weather[0].main}</strong></p>
          <p>üå°Ô∏è ${day.temp.day}¬∞C</p>
          <p>üíß ${day.humidity}%</p>
          <p>üå¨Ô∏è ${day.wind_speed} m/s</p>
        </div>`;
    }).join("");

    document.getElementById("weatherData").innerHTML = `<div class="weather-cards">${weatherHTML}</div>`;
  } catch (error) {
    console.error("Error fetching weather:", error);
    document.getElementById("weatherData").innerHTML = `<p style="color:red;">Failed to fetch weather data.</p>`;
  }
}


    // --- Open and Close Weather Popup ---
    document.getElementById("weatherButton").addEventListener("click", function () {
      openPopup();
      // Optionally, you could fetch default weather here.
      // fetchWeather("Hyderabad");
    });
    const menuButton = document.getElementById("menuButton");
const sidebar = document.querySelector(".sidebar");

menuButton.addEventListener("click", function () {
  sidebar.classList.toggle("active");
});

// Ensure popup does not prevent menu button clicks
function openPopup() {
  weatherPopup.style.display = "block";
  document.querySelector(".overlay").classList.add("active");
  sidebar.classList.remove("active"); // Optional: Hide menu when popup is open
}

function closePopup() {
  weatherPopup.style.display = "none";
  document.querySelector(".overlay").classList.remove("active");
}


    
    // --- Set Location & Fetch Weather ---
   async function setLocation() {
  const city = locationInput.value.trim();
  if (!city) return;

  fetch(`https://api.openweathermap.org/data/2.5/forecast?q=${city}&appid=${apiKey}&units=metric`)
    .then(response => response.json())
    .then(data => {
      const weatherContainer = document.getElementById("weatherData");
      weatherContainer.innerHTML = "";

      const dailyMap = {};
      data.list.forEach(item => {
        const date = item.dt_txt.split(" ")[0];
        if (!dailyMap[date] && item.dt_txt.includes("12:00:00")) {
          dailyMap[date] = item;
        }
      });

      const weatherCards = document.createElement("div");
      weatherCards.className = "weather-cards";

      Object.values(dailyMap).slice(0, 7).forEach(day => {
        const card = document.createElement("div");
        card.className = "weather-card";
        card.innerHTML = `
          <h3>${new Date(day.dt_txt).toLocaleDateString()}</h3>
          <p><strong>${day.weather[0].main}</strong></p>
          <p>Temp: ${day.main.temp}¬∞C</p>
          <p>Humidity: ${day.main.humidity}%</p>
        `;
        weatherCards.appendChild(card);
      });

      weatherContainer.appendChild(weatherCards);
    })
    .catch(err => {
      console.error("Weather fetch failed:", err);
      document.getElementById("weatherData").innerHTML = "<p>Unable to retrieve weather data.</p>";
    });
}

    
    function fetchWeather(city) {
      const weatherUrl = `https://api.openweathermap.org/data/2.5/forecast?q=${encodeURIComponent(city)}&units=metric&appid=${apiKey}`;
      fetch(weatherUrl)
        .then(response => {
          if (!response.ok) throw new Error("City not found");
          return response.json();
        })
        .then(data => updateWeatherPopup(data))
        .catch(err => {
          document.getElementById("weatherData").innerHTML = `<p style="color:red;">Error: ${err.message}</p>`;
        });
    }
    
    // --- Update the Popup with Weather Data ---
    function updateWeatherPopup(data) {
      const dailyForecast = data.list.filter(forecast => forecast.dt_txt.includes("12:00:00"));
      const weatherDataDiv = document.getElementById("weatherData");
      let weatherHTML = `<div class="weather-cards">`;
      
      dailyForecast.forEach(day => {
        const date = new Date(day.dt * 1000).toLocaleDateString("en-IN", {
          weekday: "long", month: "short", day: "numeric"
        });
        const temp = Math.round(day.main.temp);
        const weather = day.weather[0].description;
        const icon = day.weather[0].icon;
        weatherHTML += `
          <div class="weather-card">
            <h3>${date}</h3>
            <img src="https://openweathermap.org/img/wn/${icon}@2x.png" alt="${weather}">
            <p>${temp}¬∞C</p>
            <p>${weather}</p>
          </div>
        `;
      });
      weatherHTML += `</div>`;
      weatherDataDiv.innerHTML = weatherHTML;
    }
    // Fetch weather initially
fetchWeather();

// Then auto-update every 5 minutes
setInterval(fetchWeather, 300000); // 5 minutes in milliseconds
function getWeather() {
    const loading = document.getElementById("loading");
    const weatherContainer = document.getElementById("weatherContainer"); // Ensure this div holds weather results

    // Show loading text & hide previous results
    loading.style.display = "block";
    weatherContainer.innerHTML = "";  

    fetchWeatherData().then(() => {
        // Hide loading after data is fetched
        loading.style.display = "none";
    }).catch(error => {
        loading.innerHTML = "Failed to fetch data. Try again!";
        console.error(error);
    });
}

loading.classList.add("show");  // Show loading
setTimeout(() => loading.classList.remove("show"), 300);  // Hide after 300ms

function toggleWeatherPopup() {
    const popup = document.getElementById("weatherPopup");
    const weatherContainer = document.getElementById("weatherContainer");
    const loading = document.getElementById("loading");

    if (!popup.classList.contains("show")) {
        // When opening, clear old data & fetch again
        weatherContainer.innerHTML = "";
        loading.style.display = "block";  
        getWeather(); // Call your function to fetch data
    }

    popup.classList.toggle("show");
}


  </script>
     <script>
      // Get the modal
      var modal = document.getElementById("logoutModal");

      // Get the button that opens the modal
      var logoutBtn = document.getElementById("logoutBtn");

      // Get the <span> element that closes the modal
      var span = document.getElementsByClassName("close")[0];

      // Get the confirm and cancel buttons
      var confirmLogout = document.getElementById("confirmLogout");
      var cancelLogout = document.getElementById("cancelLogout");

      // When the user clicks on the logout button, open the modal
      logoutBtn.onclick = function(e) {
          e.preventDefault(); // Prevent the default link behavior
          modal.style.display = "block";
      }

      // When the user clicks on <span> (x), close the modal
      span.onclick = function() {
          modal.style.display = "none";
      }

      // When the user clicks "Yes", log them out
      confirmLogout.onclick = function() {
          modal.style.display = "none";
          // Log out logic goes here (Firebase or other)
          auth.signOut()
              .then(() => {
                  window.location.href = "index.html"; // Redirect after logout
              })
              .catch((error) => {
                  console.error("Logout error:", error);
                  alert("Error logging out.");
              });
      }

      // When the user clicks "No", close the modal
      cancelLogout.onclick = function() {
          modal.style.display = "none";
      }

      // If the user clicks anywhere outside the modal, close it
      window.onclick = function(event) {
          if (event.target == modal) {
              modal.style.display = "none";
          }
      }
  </script>
</body>
</html>
